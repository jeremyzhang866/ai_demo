# Dockerfile.download
FROM ds-runtime:2.0

# å¤åˆ¶ Kerberos ç›¸å…³å’Œ HDFS é…ç½®
COPY ./dolphinscheduler.keytab /data/service/dolphinscheduler.keytab
COPY ./krb5.conf /etc/krb5.conf
COPY ./hadoop_conf /etc/hadoop/conf

# ç¯å¢ƒå˜é‡
ENV HADOOP_CONF_DIR=/etc/hadoop/conf
ENV KRB5_CONFIG=/etc/krb5.conf

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¯åŠ¨æ—¶æ‰§è¡Œ kinit + ä¸‹è½½å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ + sleep
ENTRYPOINT ["su", "-", "dolphinscheduler", "-c"]
CMD ["kinit -kt /data/service/dolphinscheduler.keytab dolphinscheduler@INSIGHT.TQCBJ.NIO.COM && echo ğŸ“¥ Downloading: $0 && hadoop fs -get $0 /app/ && echo âœ… Done && sleep 300"]